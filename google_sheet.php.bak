<?php
require __DIR__ . '/vendor/autoload.php';
// configure the Google Client
$client = new \Google_Client();
$client->setApplicationName('Google Sheets API');
$client->setScopes([\Google_Service_Sheets::SPREADSHEETS]);
$client->setAccessType('offline');
// credentials.json is the key file we downloaded while setting up our Google Sheets API
$path = 'credentials.json';
$client->setAuthConfig($path);

// configure the Sheets Service
$service = new \Google_Service_Sheets($client);
//上图我画横线的id你换成你自己的
$spreadsheetId = '1rZsrBcKY7GzLYvlEJltFpwZxilmKCB3vc9jySwV8sOo';
// $newsletter = 'No';

// 获取表单数据
$name = $_POST['name'];
$familynamename = $_POST['familyname'];
$company = $_POST['company'];
$jobtitle = $_POST['jobtitle'];
$code = $_POST['code'];
$phone = $_POST['phone'];
$email = $_POST['email'];
$message = $_POST['message'];
$newsletter = 'No';
$datetime = date("Y-m-d H:i:s");

// $spreadsheet = $service->spreadsheets->get($spreadsheetId);
// var_dump($spreadsheet);

$range = 'Sheet1'; // here we use the name of the Sheet to get all the rows

$response = $service->spreadsheets_values->get($spreadsheetId, $range);
$values = $response->getValues();
var_dump($values);
// 定义一行数据
$newRow = [
    $name,
    $familynamename,
    $company,
    $jobtitle,
    $code,
    $phone,
    $email,
    $message,
    $newsletter,
    $datetime,
];
// 可以一次追加几行
$rows = [$newRow];
//得到追加的对象
$valueRange = new \Google_Service_Sheets_ValueRange();
$valueRange->setValues($rows);
//写入到哪一个工作表
$range = 'Sheet1';
//服务将检测此工作表的最后一行
$options = ['valueInputOption' => 'USER_ENTERED'];
$service->spreadsheets_values->append($spreadsheetId, $range, $valueRange, $options);

    echo "<script>alert('Message has been sent')</script>";
    